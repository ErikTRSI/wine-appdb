:javascript
  if (appId) { appId = "#{@wine_app.id}"; }

%h3= @wine_app.name
- if user_signed_in?
  = link_to 'Edit', edit_wine_app_path(@wine_app)
  \|
  = link_to ' X ', @wine_app, :method => :delete, :data => { :confirm => 'Are you sure?' }
  \|
  = link_to 'App List', wine_apps_path

%ul


  = form_for @vote, url: wine_app_create_vote_path(@wine_app, format: :json), html: { id: "voteForm" }, remote: true, method: :post do |f| 
    %li 
      %b Difficulty
      = f.range_field :difficulty_value, { min: 0, max: 100, step: 1 }

    %li 
      %b Quality
      = f.range_field :quality_value, { min: 0, max: 100, step: 1 }
    = submit_tag "Vote", class: "btn btn-primary"
    #votealert.alert.alert-success.fade.in(style="width: 50%; display: none;")
      %button.close(type="button" data-dismiss="alert")
        :plain
          &times;
      .message

  %li 
    #vote_chart
    :javascript
      ready();
  %li
    %b Description
    [ 
    =link_to("History", wine_app_wiki_entries_path(@wine_app)) 
    ]

    #wiki
      :markdown
        #{ @wine_app.description }

    - if user_signed_in? 

      = form_for @wine_app, url: "/apps/#{@wine_app.id}/wiki/descriptions.json", html: {id: "descForm"}, remote: true, method: :post do |f|
        = f.hidden_field :description, id: "hidDescription", name: "wiki_entry"

        :javascript
          jQuery('#wiki').hallo({
            plugins: {
              'halloformat': {},
              'halloheadings': {},
              'halloblock': {},
              'hallojustify': {},
              'hallolists': {},
              'halloreundo': {}
            },
            toolbar: 'halloToolbarFixed'
          });
          jQuery('#wiki').bind('hallomodified', function(event, data) { 
            // console.debug(toMarkdown(data.content));
            jQuery('#hidDescription').val(toMarkdown(data.content)); 
          });
          jQuery('#descForm').bind('ajax:success', function(event, data, textStatus, xhr) { 
            console.debug(data);
          });

        = submit_tag "Update", class: "btn btn-primary"
        #descalert.alert.alert-success.fade.in(style="width: 50%; display: none;")
          %button.close(type="button" data-dismiss="alert")
            :plain
              &times;
          .message

        :javascript
          $('form#descForm').bind('ajax:success', 
            function(evt, data, status, xhr){
              console.log(data.message);
              $alert = $('#descalert');
              $msg = $('div:first.message', $alert);
              $msg.text(data.message);
              $alert.show();

              setInterval(function() { $alert.hide(); }, 3000);
            });
          $('form#descForm').ajaxError(function(xhr, status, error) {
            $('#descalert.message').text('Failed.');
          });

  %li 
    %b Problems
    -if @wine_app.problems.count > 0
      %ul
        - @wine_app.problems.each do |p| 
          %li= p.bug_report.bug.short_desc

  - if @wine_app.screenshots.count > 0
    %li 
      %b Screenshots
      %ul.thumbnails
        -@wine_app.screenshots.each do |ss|
          %li= link_to image_tag(ss.image.url(:thumb), class: "img-rounded"), wine_app_screenshot_path(@wine_app, ss)

